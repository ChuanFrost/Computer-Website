var shoppingCart=new Vue({el:"#shoppingCart",data:{productList:data,cartList:[],searchType:"",searchName:"",searchBrand:"",total_price:0,aboutProduct:{name:"",img:"/img/placeholder.png",price:0,imgDetail:"/img/placeholder.png"}},methods:{addToCart(t){var r={};Object.assign(r,this.productList[t]);var a=this.cartList.findIndex(t=>t.id==r.id);-1==a?r.qty<=0?SwalError("Unable to add.","Item exceeds quantity left in stock."):(r.qty=1,this.cartList.push(r),this.total_price+=this.productList[t].price):r.qty<=this.cartList[a].qty?SwalError("Unable to add.","Item exceeds quantity left in stock."):(this.cartList[a].qty+=1,this.total_price+=this.productList[t].price)},removeFromCart(t){var r=this.cartList[t];r.qty-=1,this.total_price-=this.cartList[t].price,r.qty<=0&&this.cartList.splice(t,1)},search(){var t="/Product/search?type="+this.searchType+"&brand="+this.searchBrand+"&name="+this.searchName;jsonAjax(t,"GET","",function(t){shoppingCart.productList=t},alertError)},about(t){this.aboutProduct=this.productList[t],toggleOverlay("#about-product-overlay")},formatPrice:t=>val=t.toFixed(2),clear(){this.searchName="",this.searchType="",this.searchBrand="",this.search()},recalculate(){for(var t=0,r=0;r<this.cartList.length;r++)t+=this.cartList[r].price*this.cartList[r].qty;this.total_price=t}}}),orderDetail=new Vue({el:"#place-order",data:{orderDetail:{name:"",email:"",contact:"",address:""},error:{}},methods:{handleSubmit(t){if(shoppingCart.cartList.length<=0)return SwalError("Cart is empty. Unable to place order.",""),0;var r={};Object.assign(r,this.orderDetail),r.cart=shoppingCart.cartList,r.total_price=shoppingCart.formatPrice(shoppingCart.total_price),r.searchName=shoppingCart.searchName,r.searchType=shoppingCart.searchType,r.searchBrand=shoppingCart.searchBrand,jsonAjax("/Order/PlaceOrder","POST",JSON.stringify(r),function(t){if("Success"==t.Status)return location.replace(t.Link),0;if("Quantity Error"==t.Status){toggleOverlay("#place-order-overlay"),shoppingCart.productList=t.Data;for(var r=t.Message,a="",e=0;e<r.length;e++){var i=shoppingCart.cartList.findIndex(t=>t.id==r[e].id),s=e+1;r[e].qty<=0?(a+="<p>"+s+". "+shoppingCart.cartList[i].name+" <i class='fas fa-arrow-right'></i> 0(Removed)</p>",shoppingCart.cartList.splice(i,1)):(shoppingCart.cartList[i].qty=r[e].qty,a+="<p>"+s+". "+shoppingCart.cartList[i].name+" <i class='fas fa-arrow-right'></i> "+r[e].qty+"</p>")}return Swal.fire({title:"Apologies, we are running out of stock for item(s) ordered.",html:"<p>Cart is automatically refreshed, changes are as follow:<p>"+a}),shoppingCart.recalculate(),0}return"Validation Error"==t.Status?(SwalError("Validation Error",""),orderDetail.error=t.Message,0):"Database Error"==t.Status?(SwalError("Database Error",""),0):void 0},alertError)}}});
